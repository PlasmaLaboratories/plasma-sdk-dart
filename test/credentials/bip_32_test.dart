import 'dart:typed_data';

import 'package:mubrambl/src/bip/topl.dart';
import 'package:test/test.dart';

final chainPairs = [
  {
    'xprv': <int>[
      8,
      208,
      117,
      156,
      246,
      240,
      129,
      5,
      115,
      137,
      69,
      234,
      44,
      212,
      6,
      127,
      23,
      57,
      69,
      23,
      59,
      95,
      227,
      106,
      11,
      93,
      104,
      200,
      200,
      73,
      53,
      73,
      69,
      133,
      191,
      62,
      123,
      17,
      214,
      135,
      196,
      214,
      76,
      115,
      221,
      237,
      88,
      145,
      89,
      0,
      220,
      155,
      177,
      63,
      6,
      42,
      149,
      50,
      168,
      54,
      109,
      250,
      151,
      26,
      220,
      217,
      174,
      92,
      78,
      243,
      30,
      254,
      222,
      246,
      238,
      218,
      217,
      105,
      138,
      21,
      248,
      17,
      209,
      0,
      64,
      54,
      182,
      98,
      65,
      56,
      80,
      129,
      212,
      22,
      67,
      207
    ],
    'xpub': <int>[
      113,
      16,
      181,
      232,
      98,
      64,
      229,
      27,
      64,
      250,
      170,
      199,
      138,
      11,
      146,
      97,
      95,
      233,
      106,
      237,
      55,
      108,
      221,
      7,
      37,
      95,
      8,
      174,
      122,
      233,
      206,
      98,
      220,
      217,
      174,
      92,
      78,
      243,
      30,
      254,
      222,
      246,
      238,
      218,
      217,
      105,
      138,
      21,
      248,
      17,
      209,
      0,
      64,
      54,
      182,
      98,
      65,
      56,
      80,
      129,
      212,
      22,
      67,
      207
    ]
  },
  {
    'xprv': <int>[
      136,
      139,
      164,
      211,
      41,
      83,
      9,
      1,
      85,
      203,
      203,
      210,
      107,
      190,
      108,
      109,
      101,
      231,
      70,
      62,
      178,
      26,
      62,
      201,
      95,
      107,
      26,
      244,
      199,
      73,
      53,
      73,
      107,
      114,
      60,
      151,
      42,
      161,
      222,
      34,
      91,
      158,
      140,
      143,
      55,
      70,
      160,
      52,
      243,
      207,
      103,
      197,
      30,
      69,
      196,
      152,
      57,
      104,
      177,
      102,
      118,
      76,
      242,
      108,
      146,
      22,
      184,
      101,
      243,
      155,
      18,
      117,
      21,
      219,
      154,
      213,
      89,
      30,
      127,
      203,
      144,
      134,
      4,
      185,
      213,
      5,
      107,
      139,
      122,
      201,
      140,
      249,
      189,
      48,
      88,
      198
    ],
    'xpub': <int>[
      57,
      62,
      105,
      70,
      232,
      67,
      221,
      58,
      185,
      172,
      49,
      69,
      36,
      222,
      199,
      248,
      34,
      231,
      119,
      108,
      190,
      46,
      8,
      73,
      24,
      231,
      16,
      3,
      208,
      186,
      255,
      188,
      146,
      22,
      184,
      101,
      243,
      155,
      18,
      117,
      21,
      219,
      154,
      213,
      89,
      30,
      127,
      203,
      144,
      134,
      4,
      185,
      213,
      5,
      107,
      139,
      122,
      201,
      140,
      249,
      189,
      48,
      88,
      198
    ]
  },
  {
    'xprv': <int>[
      192,
      183,
      18,
      244,
      192,
      226,
      223,
      104,
      208,
      5,
      65,
      18,
      239,
      176,
      129,
      167,
      253,
      248,
      163,
      202,
      146,
      9,
      148,
      191,
      85,
      92,
      64,
      228,
      194,
      73,
      53,
      73,
      147,
      247,
      116,
      174,
      145,
      0,
      93,
      168,
      198,
      155,
      44,
      76,
      89,
      250,
      128,
      215,
      65,
      236,
      234,
      103,
      34,
      38,
      42,
      107,
      69,
      118,
      210,
      89,
      207,
      96,
      239,
      48,
      192,
      87,
      99,
      240,
      181,
      16,
      148,
      38,
      39,
      208,
      200,
      180,
      20,
      53,
      136,
      65,
      161,
      151,
      72,
      236,
      67,
      225,
      19,
      93,
      47,
      12,
      77,
      129,
      88,
      49,
      136,
      225
    ],
    'xpub': <int>[
      144,
      109,
      104,
      22,
      156,
      139,
      191,
      195,
      240,
      205,
      144,
      20,
      97,
      196,
      200,
      36,
      233,
      171,
      124,
      219,
      175,
      56,
      183,
      182,
      189,
      102,
      229,
      77,
      160,
      65,
      17,
      9,
      192,
      87,
      99,
      240,
      181,
      16,
      148,
      38,
      39,
      208,
      200,
      180,
      20,
      53,
      136,
      65,
      161,
      151,
      72,
      236,
      67,
      225,
      19,
      93,
      47,
      12,
      77,
      129,
      88,
      49,
      136,
      225
    ]
  }
];

final chainPrv = [
  192,
  83,
  119,
  239,
  40,
  34,
  121,
  84,
  152,
  152,
  197,
  161,
  95,
  226,
  2,
  188,
  148,
  22,
  200,
  162,
  111,
  232,
  31,
  254,
  30,
  25,
  193,
  71,
  194,
  73,
  53,
  73,
  214,
  21,
  71,
  105,
  27,
  114,
  215,
  57,
  71,
  229,
  136,
  222,
  212,
  150,
  118,
  136,
  248,
  45,
  185,
  98,
  139,
  233,
  187,
  0,
  197,
  173,
  22,
  181,
  223,
  175,
  96,
  42,
  197,
  244,
  25,
  189,
  87,
  95,
  142,
  162,
  63,
  161,
  165,
  153,
  177,
  3,
  248,
  94,
  99,
  37,
  191,
  45,
  52,
  176,
  24,
  255,
  111,
  43,
  140,
  243,
  249,
  21,
  225,
  156
];
final chainPb = [
  43,
  27,
  44,
  0,
  227,
  92,
  159,
  156,
  45,
  236,
  38,
  206,
  59,
  165,
  151,
  80,
  77,
  47,
  200,
  104,
  98,
  182,
  3,
  91,
  5,
  52,
  10,
  255,
  138,
  126,
  188,
  75,
  197,
  244,
  25,
  189,
  87,
  95,
  142,
  162,
  63,
  161,
  165,
  153,
  177,
  3,
  248,
  94,
  99,
  37,
  191,
  45,
  52,
  176,
  24,
  255,
  111,
  43,
  140,
  243,
  249,
  21,
  225,
  156
];
const derivator = Bip32Ed25519KeyDerivation.instance;
final chainPrvSigning = Bip32SigningKey(Uint8List.fromList(chainPrv));
final chainPubVerify = Bip32VerifyKey(Uint8List.fromList(chainPb));

void main() {
  group('Key Generation', () {
    var idx = 0;
    chainPairs.forEach((keypair) {
      test('m/1852\'/1815\'/0\'/0/$idx', () {
        final xprv = keypair['xprv'] ??= [];
        final xpub = keypair['xpub'] ??= [];
        final k = Bip32SigningKey(Uint8List.fromList(xprv));
        final K = Bip32VerifyKey(Uint8List.fromList(xpub));
        final derivedPrv = derivator.ckdPriv(chainPrvSigning, idx);
        final derivedPub = derivator.ckdPub(chainPubVerify, idx);
        assert(k == derivedPrv);
        assert(K == derivedPub);
        idx++;
      });
    });
  });
}
